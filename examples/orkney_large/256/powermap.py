from opentidalfarm import *
import sys
set_log_level(PROGRESS)

# Some domain information extracted from the geo file
site_x = 2000.
site_y = 1000.
site_x_start = 1.03068e+07 
site_y_start = 6.52276e+06 - site_y 

inflow_x = 8400.
inflow_y = -1390.
inflow_norm = (inflow_x**2 + inflow_y**2)**0.5
inflow_direction = [inflow_x/inflow_norm, inflow_y/inflow_norm]
print "inflow_direction: ", inflow_direction

config = SteadyConfiguration("../mesh/earth_orkney_converted.xml", inflow_direction = inflow_direction) 
config.set_site_dimensions(site_x_start, site_x_start + site_x, site_y_start, site_y_start + site_y)
config.params['viscosity'] = 30.0
config.params['save_checkpoints'] = False
config.info()

# Place some turbines 
deploy_turbines(config, nx = 32, ny = 8)
config.params["turbine_friction"] = 0.5*numpy.array(config.params["turbine_friction"]) 

turbine_pos = [ 10306810.        ,   6521770.        ,  10306810.        ,
                6521799.99999999,  10306885.00000001,   6521795.98076209,
                10306973.81364876,   6521864.52634386,  10307242.64668961,
                6521874.37001967,  10307184.91901446,   6521806.90926738,
                10307227.34303865,   6521848.56666984,  10307401.22160521,
                6521769.99999993,  10306840.        ,   6521770.        ,
                10306853.84889317,   6521796.61289224,  10306914.96487596,
                6521797.43225244,  10307126.24430718,   6521795.98076208,
                10307255.92591503,   6521903.08842915,  10307536.84907154,
                6521796.27664752,  10307381.28095135,   6521792.41362288,
                10307270.11181376,   6521944.12132623,  10306869.99999999,
                6521770.        ,  10306900.        ,   6521769.99999999,
                10307051.24430718,   6521769.99999998,  10307461.2216052 ,
                6521769.99999996,  10307301.34029737,   6521769.99999996,
                10307611.55563288,   6521840.77281781,  10307631.23936998,
                6521863.41288461,  10308148.94184345,   6522007.27692029,
                10306930.        ,   6521770.        ,  10306937.58891271,
                6521817.13388121,  10307208.95363545,   6521824.86366277,
                10307157.21648005,   6521795.39495743,  10307506.27311543,
                6521795.95095585,  10307646.11602707,   6521889.4648251 ,
                10307674.17303815,   6521962.82951769,  10307476.2216052 ,
                6521795.98076209,  10306960.72354029,   6521770.        ,
                10306958.26877006,   6521838.86756023,  10306990.05828412,
                6521899.9723859 ,  10307235.38164264,   6521769.99999997,
                10307763.89576238,   6521795.98076209,  10307588.57543414,
                6521821.48762362,  10308079.37841647,   6521909.75573457,
                10307591.98086081,   6522750.00000001,  10306991.24430716,
                6521770.        ,  10307021.24430715,   6521769.99999999,
                10307203.20529613,   6521769.99999997,  10307491.22160519,
                6521769.99999997,  10307659.91628391,   6521920.3579714 ,
                10308013.51747824,   6521848.91161373,  10308098.72749722,
                6521932.68251808,  10307699.90146522,   6522750.00000001,
                10307081.24430716,   6521770.        ,  10307111.24430716,
                6521769.99999999,  10307566.43502296,   6521801.24385916,
                10307431.22160519,   6521769.99999998,  10308037.52612782,
                6521866.90047489,  10308059.69179878,   6521887.11687144,
                10308162.668995  ,   6522033.95340332,  10307774.2085122 ,
                6522750.00000001,  10307141.24430716,   6521770.        ,
                10307173.18865293,   6521769.99999999,  10307521.32462564,
                6521769.99999998,  10307623.24141755,   6521797.53167174,
                10307989.24489903,   6521831.27785964,  10308116.82246509,
                6521956.61138774,  10308198.43109094,   6522116.53068677,
                10307834.5971168 ,   6522750.00000001,  10307269.01289126,
                6521770.        ,  10307331.34029736,   6521769.99999999,
                10307611.32462563,   6521769.99999999,  10307942.87985999,
                6521803.27472921,  10308187.04079505,   6522088.77662831,
                10308209.36836934,   6522144.46594748,  10308243.7361841 ,
                6522623.45962299,  10307885.38004308,   6522750.00000001,
                10307361.34029736,   6521770.        ,  10307551.32462563,
                6521769.99999999,  10307718.89576234,   6521769.99999999,
                10308133.40324912,   6521981.61368675,  10308220.00037324,
                6522172.51879075,  10308254.54759566,   6522580.72962713,
                10308216.54513609,   6522676.87209367,  10307930.82730837,
                6522750.        ,  10307581.32462562,   6521770.        ,
                10307698.03362888,   6521791.55861711,  10307823.67223418,
                6521796.12172021,  10308175.18800635,   6522061.21724757,
                10308229.48611536,   6522200.97979939,  10308258.85902866,
                6522207.08196721,  10308266.90248898,   6522346.10912613,
                10307971.2566955 ,   6522750.        ,  10307647.17149542,
                6521770.        ,  10307748.89576234,   6521769.99999999,
                10307853.75918932,   6521796.06032926,  10308192.53968235,
                6522036.74354359,  10308238.88793967,   6522229.46857241,
                10308231.38287636,   6522650.79825083,  10308199.43342049,
                6522701.51337278,  10308008.52370138,   6522750.        ,
                10307677.17149543,   6521770.        ,  10307778.89576237,
                6521769.99999999,  10307972.73504238,   6521806.22793187,
                10308204.98152454,   6522064.73212182,  10308228.09237555,
                6522121.02635621,  10308254.29288397,   6522287.44906559,
                10308277.43270904,   6522465.1684107 ,  10308041.28387901,
                6522750.        ,  10307808.89576237,   6521770.        ,
                10307913.75918931,   6521796.06032924,  10308002.45333412,
                6521802.12354951,  10308216.77166267,   6522092.78937197,
                10308238.97884619,   6522149.28478364,  10308260.59768648,
                6522316.77909586,  10308178.40170036,   6522722.90658247,
                10308071.28387901,   6522750.        ,  10307838.89576236,
                6521770.        ,  10307868.89576237,   6521769.99999999,
                10308071.63006694,   6521859.59426435,  10308129.1667314 ,
                6521929.2671981 ,  10308247.07251019,   6522258.33089122,
                10308277.0567503 ,   6522405.22901863,  10308284.53778771,
                6522581.50058867,  10308101.28387901,   6522750.        ,
                10307883.7591893 ,   6521796.06032925,  10307898.89576237,
                6521769.99999999,  10308025.48140607,   6521821.35677442,
                10308249.39120078,   6522178.53440143,  10308267.97572621,
                6522236.81168582,  10308268.81056597,   6522666.30164788,
                10308244.47249101,   6522720.78312443,  10308131.283879  ,
                6522750.        ,  10307928.89576236,   6521770.        ,
                10308049.47333078,   6521839.36800673,  10308110.69893356,
                6521905.17439302,  10308146.76548317,   6521954.75315709,
                10308278.59160804,   6522435.19020761,  10308272.63095041,
                6522375.55714027,  10308326.28387902,   6522724.01923789,
                10308161.283879  ,   6522750.        ,  10307958.89576237,
                6521770.        ,  10308091.31668463,   6521882.23312749,
                10308175.07308119,   6521798.47068248,  10308178.90793119,
                6522008.72709987,  10308275.45649717,   6522495.10402277,
                10308273.3264737 ,   6522525.02856205,  10308268.8750194 ,
                6522607.08737609,  10308191.283879  ,   6522750.        ,
                10307988.89576236,   6521770.        ,  10308066.06831818,
                6521794.59927848,  10308163.39754775,   6521980.98847757,
                10308295.45544151,   6522355.31402213,  10308270.64838117,
                6522554.90935525,  10308273.68288981,   6522636.69970615,
                10308330.99727416,   6522694.38908157,  10308221.283879  ,
                6522750.        ,  10308018.89576236,   6521770.        ,
                10308160.99356529,   6521769.99999999,  10308275.89977579,
                6522266.6369513 ,  10308301.18390294,   6522384.76203626,
                10308305.60970283,   6522414.43391463,  10308259.5091172 ,
                6522694.82341077,  10308355.12052541,   6522676.55373157,
                10308251.283879  ,   6522750.        ,  10308048.89576236,
                6521770.        ,  10308192.96437066,   6521839.07954039,
                10308282.8458365 ,   6522296.6539616 ,  10308312.67138328,
                6522443.59133057,  10308324.97899714,   6522532.72837976,
                10308332.69975462,   6522561.71874292,  10308341.08792782,
                6522620.97096015,  10308281.283879  ,   6522750.        ,
                10308118.92132421,   6521770.        ,  10308758.944665  ,
                6521955.37106418,  10308289.150639  ,   6522325.98399188,
                10308690.87832345,   6522505.42420361,  10308317.52359706,
                6522473.19697759,  10308339.04730713,   6522591.04039154,
                10308339.51764683,   6522650.92990071,  10308311.283879  ,
                6522750.        ,  10308295.56726074,   6521770.        ,
                10308760.47767007,   6522015.33239897,  10308755.16372168,
                6522135.17338602,  10308745.16232512,   6522226.69037034,
                10308681.36392631,   6522537.46766207,  10308321.59315395,
                6522502.91974458,  10308625.34034774,   6522701.09107837,
                10308341.283879  ,   6522750.        ,  10308389.13759376,
                6521770.        ,  10308758.98130888,   6522075.29545182,
                10308752.68318822,   6522165.0707755 ,  10308749.0821901 ,
                6522195.08931505,  10308714.77746671,   6522411.44268049,
                10308650.88396248,   6522637.10917644,  10308543.11001215,
                6522750.00000001,  10308385.17348764,   6522750.        ,
                10308472.8869805 ,   6521770.        ,  10308760.47767007,
                6522045.33239898,  10308757.20768318,   6522105.24303657,
                10308731.56020782,   6522320.88626417,  10308736.66916603,
                6522289.30426301,  10308671.41052488,   6522570.88973648,
                10308639.34226797,   6522669.04865405,  10308438.76917716,
                6522750.        ,  10308546.80052317,   6521770.        ,
                10308760.47767008,   6521985.33239899,  10308790.00000002,
                6522130.00000001,  10308740.91859896,   6522257.41696464,
                10308726.87032523,   6522351.12130659,  10308721.19705022,
                6522381.20850015,  10308661.27406888,   6522604.76609641,
                10308493.16930224,   6522750.        ,  10308608.9450878 ,
                6521770.        ,  10308756.94749429,   6521925.43703989,
                10308790.00000001,   6522100.00000001,  10308789.23639539,
                6522313.37377941,  10308788.7600413 ,   6522417.43286252,
                10308707.30164699,   6522443.02275305,  10308753.19996142,
                6522703.16250914,  10308583.04348218,   6522750.        ,
                10308660.85491951,   6521770.        ,  10308736.89942716,
                6521807.20262838,  10308790.00000001,   6522070.        ,
                10308789.50015564,   6522220.61372984,  10308789.2979779 ,
                6522382.76910311,  10308699.43318172,   6522474.79097742,
                10308762.70662187,   6522673.03239182,  10308615.2431208 ,
                6522750.        ,  10308700.00000001,   6521770.        ,
                10308790.00000001,   6521890.        ,  10308748.9823025 ,
                6521865.97148221,  10308790.00000001,   6522160.47629892,
                10308787.39905149,   6522452.89136641,  10308786.50794762,
                6522486.90944524,  10308777.23451863,   6522582.84810138,
                10308651.2623448 ,   6522750.        ,  10308730.        ,
                6521770.        ,  10308790.00000001,   6521860.        ,
                10308790.00000001,   6521949.99999999,  10308790.00000001,
                6521979.99999998,  10308790.        ,   6522190.60742084,
                10308789.36440165,   6522347.21032446,  10308768.93140197,
                6522643.21453414,  10308703.05379342,   6522750.        ,
                10308760.        ,   6521770.        ,  10308790.        ,
                6521829.99999999,  10308790.00000001,   6521919.99999999,
                10308790.        ,   6522009.99999999,  10308789.34749003,
                6522250.75124604,  10308783.35173763,   6522519.31901872,
                10308773.29995971,   6522613.20712906,  10308744.72275574,
                6522750.        ,  10308790.        ,   6521770.        ,
                10308790.        ,   6521799.99999999,  10308743.20115457,
                6521836.5334317 ,  10308753.29896517,   6521895.65960187,
                10308790.        ,   6522039.99999998,  10308789.25099871,
                6522281.34558296,  10308780.76343996,   6522551.39022003,
                10308790.        ,   6522750.]

config.params['turbine_pos'] = numpy.reshape(turbine_pos, [-1, 2])

rf = ReducedFunctional(config)
J = rf.dj(turbine_pos, forget=False)
